(()=>{"use strict";var t={formEl:$("#pwd_criteria_form"),saveAPIUrl:baseUrl+"/save",getPwdCriteriaAPIUrl:baseUrl+"/get_pwd_criteria/",init:function(){this.initTouchSpin(),this.initBootstrapSwitch(),this.initSelect2(),this.initValidation(),this.bindEvents(),this.getPasswordCriteria()},bindEvents:function(){t.formEl.on("change","#logout_format",t.changeLogoutDuration.bind(this)),t.formEl.on("change","#unlock_format",t.changeUnlockDuration.bind(this))},initTouchSpin:function(){$(".kt_touchspin").TouchSpin({buttondown_class:"btn btn-secondary",buttonup_class:"btn btn-secondary",verticalbuttons:!0,verticalup:'<i class="fa fa-angle-up"></i>',verticaldown:'<i class="fa fa-angle-down"></i>'})},initBootstrapSwitch:function(){$("[data-switch=true]").bootstrapSwitch()},initSelect2:function(){$(".kt-selectpicker").select2({placeholder:"Select an option"})},getPasswordCriteria:function(){t.formEl.trigger("reset"),t.formEl.find("[selected]").each((function(){$(this).removeAttr("selected")})),$.ajax({url:t.getPwdCriteriaAPIUrl,type:"get",success:function(e){e.error&&commonUtils.notifyMessageError(a.message);var a=e;t.prefilFormData(a),t.formEl.valid()},error:function(t){commonUtils.notifyMessageError(t.message)}})},enableBootstrapSwitch:function(t,e){if(t[e]<=0)return!1;$("[name='"+e+"']").bootstrapSwitch("state",!0)},changeUnlockDuration:function(t){var e,a=59;"Hour"==$("#unlock_format").val()&&(a=24);for(var n=[],o=1;o<=a;o++)n.push({id:o,text:o});e=JSON.stringify(n),$("#unlock_time").select2({placeholder:"Select an option",data:JSON.parse(e)})},changeLogoutDuration:function(t){var e,a=59;"Hour"==$("#logout_format").val()&&(a=24);for(var n=[],o=1;o<=a;o++)n.push({id:o,text:o});e=JSON.stringify(n),$("#logout_time").select2({placeholder:"Select an option",data:JSON.parse(e)})},prefilFormData:function(e){if($.isEmptyObject(e))return!1;t.enableBootstrapSwitch(e,"has_alphabet"),t.enableBootstrapSwitch(e,"has_number"),t.enableBootstrapSwitch(e,"has_special_char"),t.enableBootstrapSwitch(e,"has_pwd_expiry"),t.enableBootstrapSwitch(e,"reuse_pwd"),t.enableBootstrapSwitch(e,"auto_lock"),t.enableBootstrapSwitch(e,"auto_unlock"),t.enableBootstrapSwitch(e,"auto_logout"),t.setDuration(e,"unlock_time"),t.setDuration(e,"logout_time"),t.formEl.loadDataFromJSON(e)},initValidation:function(){commonUtils.extendValidatorMethod(),jQuery.validator.addMethod("minLengthCheck",(function(t,e,a){var n=($('[name="has_alphabet"]').prop("checked")&&parseInt($('[name="alphabet_cnt"]').val())||0)+($('[name="has_special_char"]').prop("checked")&&parseInt($('[name="special_char_count"]').val())||0)+($('[name="has_number"]').prop("checked")&&parseInt($('[name="number_min_count"]').val())||0);return isNaN(t)&&isNaN(n)||Number(t)>=Number(n)}),"Must be greater than all the summation of min length."),t.validator=t.formEl.validate({ignore:":hidden",rules:{min_length:{number:!0,requiredNonZero:!0,minLengthCheck:!0},max_length:{number:!0,requiredNonZero:!0,greaterThanOrEqualTo:"#min_length"},alphabet_cnt:{notEqualToEmpty:$('[name="has_alphabet"]')},special_char_count:{notEqualToEmpty:$('[name="has_special_char"]')},allowed_spec_char:{notEqualToEmpty:$('[name="has_special_char"]')},validity_period:{notEqualToEmpty:$('[name="has_pwd_expiry"]')},reuse_after_x_times:{notEqualToEmpty:$('[name="reuse_pwd"]')}},invalidHandler:function(e,a){a=a||{},$.isEmptyObject(a.invalid)||setTimeout((function(){t.formEl.find('[name="'+Object.keys(a.invalid)[0]+'"]').focus()}),100)},submitHandler:function(e){var a=$(e).getFormDataToJSON();a.number_min_count=$('[name="number_min_count"]').val(),a.has_alphabet=$('[name="has_alphabet"]').prop("checked")?1:0,a.has_number=$('[name="has_number"]').prop("checked")?1:0,a.has_special_char=$('[name="has_special_char"]').prop("checked")?1:0,a.has_pwd_expiry=$('[name="has_pwd_expiry"]').prop("checked")?1:0,a.reuse_pwd=$('[name="reuse_pwd"]').prop("checked")?1:0,a.alphabet_type=$('[name="alphabet_type"]').val(),a.auto_lock=$('[name="auto_lock"]').prop("checked")?1:0,a.auto_unlock=$('[name="auto_unlock"]').prop("checked")?1:0,a.auto_logout=$('[name="auto_logout"]').prop("checked")?1:0,$.ajax({url:t.saveAPIUrl,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:a,dataType:"json",success:function(e){e.error&&commonUtils.notifyMessageError(a.message),t.getPasswordCriteria()},error:function(t){commonUtils.notifyMessageError(t.message)}})}})},setDuration:function(t,e){var a=59,n=(t=t||{}).logout_format;"unlock_time"==e&&(n=t.unlock_format),"Hour"==n&&(a=24);for(var o,r=[],i=1;i<=a;i++)r.push({id:i,text:i});o=JSON.stringify(r),$("#"+e).select2({placeholder:"Select an option",data:JSON.parse(o)})}};$("input[name='invalid_attempt_allowed_time']").TouchSpin({buttondown_class:"btn btn-secondary",buttonup_class:"btn btn-secondary",verticalbuttons:!0,verticalup:'<i class="fa fa-angle-up"></i>',verticaldown:'<i class="fa fa-angle-down"></i>',max:5}),$(document).ready((function(){t.init()}))})();
